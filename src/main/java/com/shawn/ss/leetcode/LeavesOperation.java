package com.shawn.ss.leetcode;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class LeavesOperation {

    public static void main(String[] args) {
        //        int ret = new LeavesOperation().minimumOperations("yyyrrrrrrrryyrrryryyyryyyyryrrryyrrryrryyryryryyrrryyyyyyrrrrryrryryyrrrryyyryrrrryyrryrrrryryryrrryyyyyyrrrryryrrrryrryyrrryryyyyryyyyyryrryryrryyryyryryrrrryryrryyyryrrryrrryryyyyyrryyrryrrrryrrrrryrryyyyyrrryryyyryryrrrryrryrryryyyryryryyyrrryryrrryrrrryrryrryryyrrrrryyrrryrrrryyryryryrrryyyyrryrryyrrrrrrryyryyrryryrryyrryrrrrryyyyyrrryyrryrrryrrrrrryyryyyrrrrrryryrrryyrryyyrrryrrrryyyyryryyyryrryyyyyrrryyyyrrryryyyryyryrryyyyyyyyrryyyyryryyyrrryyryyyyyyrryryrryyryryrrrryryrrrryryyryryryryryryyryyrryyyryrryyryyrryyyrrrryyyyrryrryyrryyyryyyryyrryyyyryyryyrryrryyrryryyyyrrryyyyyyryyyyryryrryyyyryrrrrryrrryrryrryyyyryyryyrrryyyryrrryryyrryyyrryryrryyyryyyyryyyryyryrrryryryryrryryyyyryyryyryyryryrrrrrrryyryryyrryyrryryrryyryyrryyyryyyrrrrryryrryyryyrryyyrryyryryrryrrryyyyyrryyrrrryyyyyyyryyyyrrrryrryyryyryrryyyyryyrrrryrrryyrryrrryryrryyrrryyrryyyryyyyyyryyrrrryryyyyryyrryrrryyrryryryryryrryrrryyyryyyyryryyrryryryrryyryrrrryyyryryyyrryyrryyyyyyyryrryryyyryyyrrrrryyyyryrrryrryryryyrryrrryrryrryryrrrrrryyrryyryryryyryyyrryryryyyyryyryryyyyrrryyyrrryrryyyyyrrrryyyrryrrrrryyryyrryryrryryryrryyyrrrrrryyyyrrrryyryyryrrryyryyryrryryyyyrrryyryryryyryyyyryryyyryrryryyrrryyryryryrrrryyryrrryyyyrrrrrrrryryyyyyryyryyyrrryyrrrrryyrrryryyrryrryryyrryrryryryrryyryryrrryrryrrrrrrryyryyrrryyrryyyrrryyyyyryyyrrrrrrryrrrryyyyryyrrrryryrryyrryryrrryrryyrryyyrrrryyyyrryryryrrrryyrryryrrryyrrrryrrrryyryyyyyrrryyyryryryrrrrrrryryyryyrryryyrryyrrrrrrryrrrryyrryrrrrrrrryrrrryryryryryyyyyyryyyyyrrrryyyyyyyrryyyyrrryrryryyyryrrrryryrrryyrrryryrrryryyyyyrryrryyryryyyyyrrryrryrryryyryyyryyryyryryyyyyryyryyryrrrryyryyrrryryrrrryrrrrrryyryyrryrryryryyryrrryyyyyrrryyrryyyryrryyyryyyryryryryyyrrryryrrryyrrrrrryyyrryrryrryyrryrryryyryrrrryryyryrrrryyryyyryrrryrrrrrrrrrryrryyyyryyyrrryrrrrryrryrrryyyyryyrrrrryyrrrryyyyyyrrryyrryyryyyrryyyrryyyyrrryyyyyrryryyryyyyryryyyyyrrryryryyrrrryyyryrrrrryyrryyryryyyyyrryrrrryyyryyyryrrryrryryyryyyryyyrrrrrrryryrryyyyryyyyyyryyrryyyyyyyryrryyrryyrryrrrryryyrrryyyryryrrrrryrryryrrryyyyyyryryryyyryrrryryryyryrryyyryrryyyyrrryyryyyyyryyyrryryyyryyryrryrryrrrrryryyyrrryyyyryyyyyyrryyrryyyryyyyrryrryryryyryryrrryrrrryyyyrrryyyyyryyyryrrrryyyyrryyryryrryyyrryyyryyrrryyryyryryrrrryryyrrrrrrrrryrryryrryyrrrryyryrrrryyyrrrryyyyyrrryyyyrrryyryrryrrrryyyryrryyyyyrryryryyyyryryrryyyrryyryyyyryyryrryryryyyyyyyryryrrrryryyrryyyrrryyryrrryryyrryryyyyyyrryyryrryyyyyyrryrrryyyyrrryryryyyyyyrrryyrrrryryyyyyyyyrryyyyyryyyyryryyrrryrrryryryrrryryyrryyyyryryyryryyyyyyyyryrrryrrrrrryyryrryyyyryyyryyyyrrrryrrryyryryrryyryyrryyyryyryyyryyyrrryyyyrryryyrrrrryrrrryyyryyrrryyyyryyryryyryrrryrryryrrrryyrryryrrryyrrrrrryyrrryryrrryrryryryyyrrrrrrrrryyrrrryyryryrryyryyyrryryyyrrrrrrrrryyrryrrrrrrrrryryrrrryyryyryyyyrrryryyryyyyyyyryyyyyyrrryrryryyyrryyryryrrrrryrryrryrryyyyrryryyyrryrrrrrryryyryyyyrryrryrrryyyrryyyyryrryryryrrrryyrrryyyyryyyyryryyyrryrryyyyryyyryyyyryryrrrrrrrrryryyryrrryyyyyyyrryyrryyyyyrryrrrrrryyyyrrrryyryyyrrryryyrryryryryryyyrryrryyryrrryyryrrryyryyyrrryrrrrryryyyyryryrryryyrryyyryrrryrryyryryyrrrryyyryryryyyyrryyyyyrryrrryyyrrryrrryyyrryyyyrryyyryyyrrryrryyrrrryyrrryyryryyyrryrrrryyyyyyyryyrryrrryyryyyyyrrryrrrryryyryyyyryyyryrryyryryyrryyrrryrryyyrryyrryrryyrrrryyrryryyyrryryrryyyyyyyyyryryryyrryrryrrrryyyrrrryyrryryrrrrryryyyyyyrryyyyrrryryyryyryryyyyryyrryyyrryyyyrryryyyyyryyryryryrrryryyryyryyyryrrrrrrryrryyrrrryrryyryyrryryyryryryyyryyyyyyyrryyryyrrrryyyyyryyyrrryrrrryyyyyyyryyyryrrrrrryryryyrrryryryryrryyrryryyyyyrrryrryyyryyyyrryyrrrrryryyrrrrrryryyrrrryryyryrryyyyyyryyrrryryryyrrryyrryyyyyryyyyyrrryyyyrrrryyyrryyyyyrryrryryyrrryryyyyryyrrrryrrryyrryyrryyryyryrrryryyrryyyyrryrrrrrryrrryryyyrrryyrrryrryrryyyyryrryryrryrryrryrryyrryyryryyyyyyyrrrryyyrryyyryyyrryyyyrryyryryrryyryyrrrrrryyyryyryyyrrryryyyyryyyrrryryyyryyrrryrryryyyyrryyyrryryryyrryyyyyrrryryyrrryryyrryyyyrryyyrryyyrryyryyryyrryrrrryrryrryryyryrryyyrryyryyrrrryyryyyryyyyrryyryyrryyyryrrryyryrryyryrryyrrrrrrrrrrryryyyyrrrryyyyryyyrryryrrrryrrrryyyrrrryyyyryrrrrrrrrryrryrryrrrryryyyyyyrryyyrryyryryyryrryrryryrryyyrryrryrryryrrrrrryryyyryyyrrrryrrrrryrrryryryyryyryyyyryyyyrryyyyyryyyrryryyryryyryyryryrryryryyryyyryyryyryryrrrryyyrrryrryyrryyryyyrrryryryrrrryryryryryrryyyrryyyyryryryryyyyyryryrrryyyyryyryyrryyyyyryryrrryyyyyyrrrryryyyryyryrrrryryyyyryyyyyrrryryryyrrryrryyyyyyyrryryrrrrrrrryyyyyryryryryyrryrryryyrryrrryrryyryryrrryyyyyyyyrryryyrrryrryyryryrryyyyrrrryryryyrrryyryyryyrrryyyyryrryyyryyyyrryyrrryyryrryryyrryrrrrrrryyyyryrrrryrryrryyyyyyyyrryyryyyrryyryrryyrryrrrryrryrryyryyyryyyyyrryryyryrrryyryyyyyryrrryrryryyryryyryryryryyryyyyyyyyyyrryryyrryyyryryyryryrryyyyyyyryrrryrryyyrrryrrryrryryrryyyyyyyryrryyyryyrryrryyyryyyyrryryyrrryryrryryryrryyryrryrryyrryyryyryryrryryyyyyrrryryryyrryyrrrryyyrrrrryyryrryyryryyyyrrryyrrryyryyyryrryrrrryyyryryyryryyryyrrrryyyyryryyrryryryyryyyyyyryyyyyyryryyyryryyyrrryyyyrryryryrrrrryrrryrryrrrrrryyyyyryyrryrryrrrryryryrryryyyyryryrrryrrrryrryyyrryryyyrrryryyyrryrryryryyryrryrrryyrryyyrryrryyyrryyyryrryyyrryyrryyrryyrrryryyyryrryrrrrryyyrrryyryyyyyyyrryrryryryrrrryryyrrrryrryyyrryyyryyyryyrrrrrryyryyrryrryryrryyyyryrrryryryrrryyrryyrrrryyyyryryyyyyryyyryyyryyryyrryyryryyyrryryyyyrryyyyryyyyyyyrrrrrrryrryrrryyyyyrrrrryyryyyrrrryryyrryyrryryrryyyrryrrryyyrryrryryyyyrryrrryrrrrrryyyyyryrryrryryyrrrryyyryyyyryyryyrryyyrryyyrrrryrryryrrrryyyryyrryrryryrryryrryryrrryrrryyryrrrryrrrrrryrrryyryryyryrrryryyrrrryryrryryyyyyyryrryyyyrryyyryryrrryryyryyyryrrrrrrryryyryryryryyrryyryyryrryyryyrrryyryyyrryrryyyyyryrryrrryyrrryryrrrryyyrrryyyyyryrrrrryryryyryrrryryrryyrryyrrryryrrryryrrryyyryyyyryrryyrryyryrrryyyyryrrryrryryyryryyyryryyrryrrryryyyyyyryryrryryyyyyryyryryyyyrrryryyyryyryryryyrrrryyryrryryryryrryyyrrryrrrryyryrryyrryyyyyyryyrryrrrrrrrrryyyyrrryyyryryrryrrryyyyyyyyrryyryryyyyyyrrrrryyryyryrryryyyrrryyryryryyyyrrrryyrryyyryrryyyyyyryrryyryrrrrrryryrryyyyryyyrrrryyyrrryryrrrryyrrryrryrrryrrrrrrryyryryyryyyryyryyryyyrryryrrryryryrryyyryyyrrryryrryyyyyyyyyrrrrrryryrrrrryrrrryryryyryrryyrryyrrryyyryyrrryrrryyrrryrrrrryryyyyyrryyyrryyyrryyyryryryryyryyyyrryrryrryrrrryryrryyyryryrryryrryrrrrryrryyyrryyrrrrryyyyrryyrrryrrrryyrryrryyyyryryrrryyyyrryyryryyyrrryryrrrryyryyryrrrryrrryyrryrryyyyrryrrryyryyyyrryrryryyyrryrryrrryyryryyyyryryrrrrrryrryryyrryrryryryrryrrrrryyryrryyrryyryyryyryyyrrryyryryryryrrryryyyyyryryrrrryyyyrryrryyyrryyryryrrrrryyryyyrryryyyyyyrryyyrrrryyyrryrrryryrrrrrrryryyyryrryyrryrryrrrryyryrryyrrryyyyryrryyryyyryyryryrrrrrryyryryyrrryyryyyyyryrrrrrrrrryyrryyyrryryrryrryyryryrrryryrrrryyrrryryrryrrrryryrrryyyyrrryrryrryrryyyrrryyyyryryryryrryyyyryyyrrrryryryrrryyyryyyyrrryyrryyrrrrryrryrrryryrryyryryyryyyyryryryryyyyrrrrryryyryrrryryryrryyyryrryryrrryryrryrryyyyyyyyrrryryyyrryryryyyryryyyrrrryyrryryyyyryyyrrrrrrrryyryrryyryrryyrryryyryyyrrryyyryyrryyryrrryrryrrrryrrryyrryrryyyyryyyrryyyryryryryryryryyryyryryyyyyrrrrryyyyyyyryyyrryyyyyyrryryyyyyyryrryyrrryyyyyyryryrryyyrrrryryrryyryrrrrrrryryyyyyrryyyyrryrrrrrryyyyyyyryyrryryyyyryrrrrryyryyrryrrrrrrrryryyryrryrrryrryrrrryyyrryyyrrryyrryryrrryyryyryryyryrryyryyryrryrryrrrrryrrrrryryryrrrryyyrrryyyyyrryryrryrryyrryryyrryryyyryryryryyyrrrryyyrryyryryryyryyyyrrrryrryyyrrryyyyyyryryyryyrrrryryrryyrryyryyrrryyyyyrrryyyyryyyrrrryyryyyryyrryyrryyyyyyrryyyyryryryrryrrrrrryyryryyryrryryyyrrryyyyryrrrryyryrryyrrryryryryyyrrrryrrrrryyyyyryrryyyryyrrrrryyyyyyyryryyyyyyyrrryrryryyrryyyyrrrryyyryrrrrrrrrryyryrrryyryryyyyryyryyrryyyyyyrrryyyyyrryrryryyrrrryyryyrryyryyyyyrrryryyrryrrryryryryyrryyrrryyyryyryyryryrrrryyyryryyryyyrrrrryrrryyryyyyrryyyryrryyyrryyyyyryryyryyyryyyrrryyyrrryyyryryyryryyryrrryrrrrryyryrrryrrrryyrrrryyyryyryyyryyryyyyyyyrrrrryyryyyyyyyryrrryrrrrryryrryyrrrrrrryyrryyryyyyyryyyryyrryryrryryyryryyyryryryrrrryyrryryryrryrrrryrryyyyrrrrrrrrrryyyryryyyrrryryyyyyrrrrrryryryyyyyyrrryrryyrrrrrrrryyyryrryryryrrryrryyrryyrryyyyyrryyyyryyyyryyrryrrryrryryryrrryrryyrryyryyryyrrryyyyyryyyyryrryrrrryyryyrrrryrrryryyryryryryrryyyyryyrryyrryryrrryyyrryrrrrryrryrrryyyyyrrrrryyryyrrryyyyryrryyyyyyyyryyrryryyyryrryrryrryryyryrrryryrrrrrrryryryyyyyrrrryrrryrryyryryyryryryrryyrrryrryyryryyyyyyyyrrryrrryyyyryyyyyyrrrrryyyyyyyyyryrrryryryrryrrrrryyyrrryyrryyyyyyyryyyrryryryrryryryyyrryyyyryyyyryryyyyyrrrryyrrrryyyyrrrrryyryyrryryyyyryrryyyryrryyrrrrryyrrryryyrrrrryyyyyyryrrrryrrryryyryyrryryyrryrrrrryrryyyyryyyyyrryryyyryrryyrrrrryrrryyryyyrryyyyyryyyryrrryryyryyyryryyyrrryrryrrryyyryrrryryyryryyryyryrrrrryrrrryrrrrrrryyrrryryryryyryyyryyyrrryyyrrryyyryyrryrrrryyyyrryyryyyyryyryyyyrrrryyyryrrrrryrrryrrryyyrrrryyrrrryyrryyryryyrryrryrrryrrrrryyryryyrrryrrryyrryyyyrrrrrryyrryyryryrrryrryrryryrryyryyyyyrryryyyrryryrrryyyyrryryrrryryyyryyyryyryryyrrryrryyyyrrryyrryrryrrryyyryyyrryrrrryrrrryrryrrrrrrrrrryyrrrryyyyyryryyyyyryryrryyrryyryryrrryyryrryyyyryrrrrrrryyyyyryyyryrryyyrrrrrrryyyrrryrrrrryrrryyryryryryrrryryryyyyyrryyrryryyyryyrryryyyrrrryyyyyyyyryyrrrryryyyyyyryryrrrryrryyryrryryryryyyryyrrrrryyyyrryyrrryryryrryryyyryyrryyyryyryyryryryyyyyrrrrryrrryyrrrrrrrryyryryrryyryryryyrrrrrrrrrrryyyryrryrrrryryyyryyryrryyyryrrryyryrrrrryyyryyyrryrryryyyyrrryyyrrrryyryryyyyyyyrrrryyyrrryyrryrrrryryyyyyyyryryrryryryrryyryyryryyrrrryryyryyryyyyryyryyyrrrrrrrryyrrr");
//                int ret = new LeavesOperation().minimumOperations("yry");
                int ret = new LeavesOperation().minimumOperations("yyyyyy");
//        int ret = new LeavesOperation().minimumOperations("rrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrr");
        System.out.println(ret);
    }

    Map<Integer, Integer> areaCount;
    int totalArea;

    class Status {
        int colorIndex;
        int total;
        //        boolean lastRed;

        public Status(int colorIndex, int total) {
            this.colorIndex = colorIndex;
            this.total = total;
            //            this.lastRed = lastRed;
        }

        @Override
        public String toString() {
            return "Status{" +
                    "colorIndex=" + colorIndex +
                    ", total=" + total +
                    //                    ", lastRed=" + lastRed +
                    '}';
        }
    }

    public int minimumOperations(String leaves) {
        int n = leaves.length();
        if (n < 3) {
            throw new IllegalStateException("not valid input");
        }
        boolean firstIsR = leaves.charAt(0) == 'r';
        boolean lastIsR = leaves.charAt(n - 1) == 'r';
        int ret = 0;
        int count = 0;
        areaCount = new HashMap<>();
        int index = 1;
        int areaIndex = 0;
        boolean firstAreaIsR = true;
        char c = ' ';
        while (index < n - 1) {
            ++count;
            c = leaves.charAt(index);
            if (c != leaves.charAt(index + 1)) {
                if (areaIndex == 0 && c == 'r') {
                    firstAreaIsR = true;
                } else if (areaIndex == 0 && c != 'r') {
                    firstAreaIsR = false;
                }
                areaCount.put(areaIndex, count);
                areaIndex++;
                count = 0;
            }
            ++index;
        }
        if (count > 0) {
            areaCount.put(areaIndex, count);
            if (areaIndex == 0 && c == 'r') {
                firstAreaIsR = true;
            } else if (areaIndex == 0 && c != 'r') {
                firstAreaIsR = false;
            }
        } else {
            areaIndex--;
        }

        print(areaCount);
        totalArea = areaIndex;
        //ret = search(1, 0);
        ret = searchV2(firstAreaIsR);
        if (!firstIsR) ret++;
        if (!lastIsR) ret++;
        return ret;
    }

    private void print(Map<Integer, Integer> areaCount) {
        areaCount.forEach((k, v) -> {
            System.out.println(k + "->" + v + " " + (k % 2 == 0 ? 'y' : 'r'));
        });
    }


    /**
     * @param firstAreaIsR
     */
    private int searchV2(boolean firstAreaIsR) {
        /**
         * status :
         *
         */
        int area = 0;
        int colorIndex = 0;
        int ret = 1000000;

        int size = areaCount.size();
        List<Status> last = new ArrayList<>();
        last.add(new Status(0, 0));
        List<Status> cur = new ArrayList<>();
        if (totalArea == 0) {
            return firstAreaIsR ? 1 : 0;
        }
        while (area <= totalArea) {
            Integer count = areaCount.get(area);
            cur.clear();
            for (Status status : last) {
                if (area % 2 == (firstAreaIsR ? 0 : 1)) {
                    if (status.colorIndex == 0) {
                        cur.add(new Status(0, status.total));
                        cur.add(new Status(1, status.total + count));
                    } else if (status.colorIndex == 1) {
                        cur.add(new Status(1, status.total + count));
                        cur.add(new Status(2, status.total));
                    } else if (status.colorIndex == 2) {
                        cur.add(new Status(2, status.total));
                        //                        if (!status.lastRed) cur.add(new Status(1, status.total + count, false));
                    }
                } else {
                    if (status.colorIndex == 0) {
                        cur.add(new Status(0, status.total + count));
                        cur.add(new Status(1, status.total));
                    } else if (status.colorIndex == 1) {
                        cur.add(new Status(1, status.total));
                        cur.add(new Status(2, status.total + count));
                    } else if (status.colorIndex == 2) {
                        cur.add(new Status(2, status.total + count));
                        //                        if (!status.lastRed) cur.add(new Status(1, status.total, false));
                    }
                }
            }
            ++area;
            last.clear();
            //last.addAll(cur);
            int[] minSt = new int[]{Integer.MAX_VALUE, Integer.MAX_VALUE, Integer.MAX_VALUE};
            int[] minIndex = new int[3];
            int sz = cur.size();
            for (int i = 0; i < sz; ++i) {
                Status st = cur.get(i);
                if (st.total < minSt[st.colorIndex]) {
                    minSt[st.colorIndex] = st.total;
                    minIndex[st.colorIndex] = i;
                }
            }
            if (minIndex[0] < sz)
                last.add(cur.get(minIndex[0]));
            if (minIndex[1] < sz)
                last.add(cur.get(minIndex[1]));
            if (minIndex[2] < sz)
                last.add(cur.get(minIndex[2]));
        }
        System.out.println(cur);
        for (int i = 0, sz = cur.size(); i < sz; ++i) {
            Status st = cur.get(i);
            if (st.colorIndex > 0) {
                if (st.total < ret) {
                    ret = st.total;
                }
            }
        }
        return ret;
    }

    public int minimumOperations1(String leaves) {
        int n = leaves.length();
        int index = 0;
        int rstart = -1;
        int ystart = -1;
        int yend = -1;
        int ret = 0;
        boolean firstIsR = leaves.charAt(0) == 'r';
        boolean lastIsR = leaves.charAt(n - 1) == 'r';
        boolean curAreaIsR = firstIsR;
        int areaIndex = 0, totalArea = 0;
        /*
        状态1 ： r y | r | y
        状态2 ： y | r | y
         */
        while (index < n - 1) {
            if (leaves.charAt(index) != leaves.charAt(index + 1)) totalArea++;
            ++index;
        }
        if (totalArea == 2 && firstIsR && lastIsR) return 0;
        index = 0;
        while (index < n) {
            char c = leaves.charAt(index);
            if (curAreaIsR) {
                if (c == 'r') {
                    if (areaIndex == 0 || areaIndex == totalArea) {
                        //do nothing
                    } else {
                        ret++;
                    }
                } else {
                    curAreaIsR = false;
                    areaIndex++;
                }
            } else {
                if (c == 'y') {
                    //do nothing
                } else {
                    curAreaIsR = true;
                    areaIndex++;
                    if (areaIndex != totalArea)
                        ret++;
                }
            }
            ++index;
        }
        if (!firstIsR) ret++;
        if (!lastIsR) ret++;
        return ret;
    }

    private int search(int area, int colorIndex) {
        if (area > totalArea) return colorIndex >= 1 ? 0 : 10000000;
        Integer count = areaCount.get(area);
        boolean isR = area % 2 == 1;
        //        if(area==totalArea) return isR?0:count
        int change = 0;
        int unchange = 0;
        if (colorIndex == 0 && isR) {
            change = count + search(area + 1, 1);
            unchange = search(area + 1, 0);
        } else if (colorIndex == 1 && isR) {
            change = count + search(area + 1, 1);
            unchange = search(area + 1, 2);
        } else if (colorIndex == 2 && isR) {
            change = -1;
            unchange = search(area + 1, 2);
        } else if (colorIndex == 0 && !isR) {
            change = count + search(area + 1, 0);
            unchange = search(area + 1, 1);
        } else if (colorIndex == 1 && !isR) {
            change = count + search(area + 1, 2);
            unchange = search(area + 1, 1);
        } else if (colorIndex == 2 && !isR) {
            change = count + search(area + 1, 2);
            unchange = -1;
        }
        if (change < 0) {
            return unchange;
        } else if (unchange < 0) {
            return change;
        } else
            return Math.min(change, unchange);
    }
}
